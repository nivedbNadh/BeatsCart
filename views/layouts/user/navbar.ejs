<!--::header part start::-->

<style>
    .search_input {
        position: relative;
        z-index: 1000;
    }
    #search-results {
        position: absolute;
        background-color: white;
        width: 100%;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        z-index: 999;
        display: flex;
        flex-wrap: wrap;
    }
    .product {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 250px; /* Increased width */
        margin: 30px;
        padding: 15px; /* Increased padding */
        border: 1px solid #ddd;
        border-radius: 10px; /* Rounded corners */
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15); /* Deeper shadow */
        transition: transform 0.2s, box-shadow 0.2s;
        background: #fff; /* Background color */
        text-align: left; /* Left align text */
    }
    .product:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2); /* More prominent shadow on hover */
    }
    .product img {
        width: 100%; /* Full width image */
        height: auto;
        object-fit: cover;
        border-radius: 5px; /* Rounded corners for the image */
        margin-bottom: 10px;
    }
    .product h3 {
        margin: 0;
        font-size: 1.2em;
        color: #333; /* Text color */
        margin-bottom: 5px; /* Space below heading */
    }
    .product p {
        margin: 5px 0;
        font-size: 0.9em;
        color: #666; /* Text color */
    }
    .product p.price {
        font-weight: bold;
        color: #000; /* Price color */
        text-align: left; /* Align price to the left */
        width: 100%; /* Make sure it spans full width */
    }
</style>


<body>
    <!--::header part start::-->
    <header class="main_menu home_menu">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg navbar-light">
                        <a class="navbar-brand" href="index.html"> <img src="/userAssets/" alt="logo"> </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="menu_icon"><i class="fas fa-bars"></i></span>
                        </button>

                        <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
                            <ul class="navbar-nav">
                                <li class="nav-item">
                                    <a class="nav-link" href="/">Home</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_1"
                                        role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        Shop
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdown_1">
                                        <a class="dropdown-item" href="category.html"> shop category</a>
                                        <a class="dropdown-item" href="single-product.html">product details</a>
                                        
                                    </div>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_3"
                                        role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        pages
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdown_2">
                                        <a class="dropdown-item" href="login.html"> login</a>
                                        <a class="dropdown-item" href="tracking.html">tracking</a>
                                        <a class="dropdown-item" href="checkout.html">product checkout</a>
                                        <a class="dropdown-item" href="cart.html">shopping cart</a>
                                        <a class="dropdown-item" href="confirmation.html">confirmation</a>
                                        <a class="dropdown-item" href="elements.html">elements</a>
                                    </div>
                                </li>
                                
                                
                                <li class="nav-item">
                                    <a class="nav-link" href="/products">Products</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_2"
                                        role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <% if (!user) { %>

                                        Account

                                        <% } else { %>
                                            <%= user.name %>
                                            <%}%>

                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdown_2">
                                        <% if (!user) { %>

                                        <a class="dropdown-item" href="/login"> Login</a>
                                        <a class="dropdown-item" href="/signup">SignUp</a>
                                        <% } else { %>
                                            <a class="dropdown-item" href="/userProfile">Profile</a>
                                            <a class="dropdown-item" href="/orderHistory">My Order</a>
                                            <a class="dropdown-item" href="/cart">Cart</a>
                                            <a class="dropdown-item" href="/">Coupon</a>
                                            <a class="dropdown-item" href="/">walletHistory</a>
                                            <a class="dropdown-item" href="/logout">Logout</a>
                                        <%}%>

                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="hearer_icon d-flex">
                            <a id="search_1" href="javascript:void(0)"><i class="ti-search"></i></a>
                            <a href=""><i class="ti-heart"></i></a>
                            <div class="dropdown cart">
                                <a class="dropdown-toggle" href="#" id="navbarDropdown3" role="button"
                                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="fas fa-cart-plus"></i>
                                </a>

                           
<!-- 
                                <% if (!user) { %>
                                    <a href="/login" class="btn btn-login">Login</a>
                                    <a href="/signup" class="btn btn-signup">Sign Up</a>
                                    <% } else { %>
                                        <a href="/logout" class="btn btn-login">Logout</a>
                                    <%}%>  -->

                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
        <div class="search_input" id="search_input_box">
            <div class="container ">
                <form class="d-flex justify-content-between search-inner" onsubmit="searchProducts(event)">
                    <input type="text" class="form-control" id="search_input" placeholder="Search Here" oninput="debounceSearch(event)">
                    <button type="submit" class="btn" style="display:none"></button>
                    <span class="ti-close" id="close_search" title="Close Search"></span>
                </form>
            </div>
        </div>
        

        <div id="search-results" style="background-color: #ecfdff;"></div>



    </header>
    <!-- Header part end-->

    <!-- <div class="search_input" id="search_input_box">
        <div class="container ">
            <form class="d-flex justify-content-between search-inner">
                <input type="text" class="form-control" id="search_input" placeholder="Search Here">
                <button type="submit" class="btn"></button>
                <span class="ti-close" id="close_search" title="Close Search"></span>
            </form>
        </div>
    </div> -->
</header>
<!-- Header part end-->


<script>
    function debounce(func,wait) {
        let timeout;
        return function (...args) {
            const context=this;
            clearTimeout(timeout)
            timeout=setTimeout(()=> func.apply(context,args),wait)
        }
    }

    const debounceSearch=debounce(function(event){
        searchProducts(event)
    },300)

    async function searchProducts(event){
        event.preventDefault()

        const query=document.getElementById('search_input').value.trim()

        if(query.trim()===''){
            displayResults([])
            return
        }

        try {
            const response = await fetch(`/search?q=${encodeURIComponent(query)}`);
            const products=await response.json()

            displayResults(products)
            console.log(response,"responseresponseresponse")
            console.log(products,"productsproductsproductsproducts")


        } catch (error) {
            console.error('Error fetching search results:',error)
            
        }
    }

    function displayResults(products) {
        const resultsDiv=document.getElementById('search-results')
        resultsDiv.innerHTML=''

        if(products.length === 0){
            resultsDiv.innerHTML='<p>No products found.</p>'
            return
        }

        products.forEach(product => {
            const productDiv=document.createElement('div')
            productDiv.className='product'
            

            const imageUrl=Array.isArray(product.image) ? `/uploads/${product.image[0]}` : product.image
            console.log(imageUrl,"..............................................................");

            productDiv.innerHTML=`
               <a href="/productDetails/${product._id }"> 
            <img src="${imageUrl}"alt="${product.name}">
            <h3>${product.name}</h3>
            <p>Price:$${product.price}</p>
            
                        </a>
            `
            resultsDiv.appendChild(productDiv)
        });
    }
</script>